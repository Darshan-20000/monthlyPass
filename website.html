<!DOCTYPE html>
<html lang="en">
<meta http-equiv="content-type" content="text/html;charset=utf-8" />

<head>
    <meta charset="UTF-8" />
    <title>Monthly Pass</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="theme-color" content="#ffffff">
    <meta content="yes" name="apple-mobile-web-app-capable" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta content="yes" name="mobile-web-app-capable" />

    <link rel="stylesheet" href="style.css">

    <script>
        const linkElement = document.createElement('link');
        linkElement.rel = 'stylesheet';
        linkElement.type = 'text/css';
        linkElement.href = `color.css?t=${Date.now()}`;
        document.head.appendChild(linkElement);
    </script>

    <style>
        html,
        body {
            position: fixed;
            margin: 0;
            padding: 0;
            height: 100%;
            background-color: #1d86d7;
        }

        .safe-area {
            position: fixed;
            padding-top: env(safe-area-inset-top);
            background-color: #1d86d7;
            min-height: 100vh;
            box-sizing: border-box;
        }

        .content {
            background-color: #ffffff;
            height: 430vh;
            border-radius: 10px;
        }

        .interstate {
            cursor: pointer;
            transition: color 0.2s ease;
        }

        .progress-bar {
            width: 100%;
            height: 4px;
            background: #E3E3E3;
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-fill {
            width: 0%;
            height: 100%;
            background: #1D86D7;
            border-radius: 10px;
            transition: width 0.4s ease;
        }
    </style>
</head>

<body>

    <script>
        function openPopup() {
            document.getElementById('popupModal').style.display = 'flex';
        }

        function closePopup() {
            document.getElementById('popupModal').style.display = 'none';
        }
    </script>

    <script>
        let isInterstateState = true;
        let countdownInterval;

        function getShortMonthName(date) {
            return date.toLocaleString('en-US', { month: 'short' }).toUpperCase();
        }

        function updateDynamicExpiry() {
            const now = new Date();
            const year = now.getFullYear();
            const monthName = getShortMonthName(now);
            const totalDays = new Date(year, now.getMonth() + 1, 0).getDate();
            const currentDay = now.getDate();
            const remainingDays = totalDays - currentDay;

            document.querySelectorAll('.date-box').forEach(box => {
                box.innerHTML = `<div>${monthName}</div>${year}<div></div>`;
            });

            const progressPercent = (currentDay / totalDays) * 100;
            document.querySelectorAll('.progress-fill').forEach(fill => {
                if (isInterstateState) fill.style.width = progressPercent + '%';
            });

            if (isInterstateState) {
                document.querySelectorAll('.exp').forEach(exp => {
                    exp.textContent = `Expires in ${remainingDays} day${remainingDays !== 1 ? 's' : ''}.`;
                });
            }
        }

        function startCountdown(minutes = 30) {
            clearInterval(countdownInterval);
            let timer = minutes * 60;

            function updateTimer() {
                const m = Math.floor(timer / 60);
                const s = timer % 60;
                const formatted = `Expires in ${m}:${s < 10 ? '0' : ''}${s}`;
                document.querySelectorAll('.exp').forEach(exp => exp.textContent = formatted);

                const percent = ((minutes * 60 - timer) / (minutes * 60)) * 100;
                document.querySelectorAll('.progress-fill').forEach(fill => fill.style.width = percent + '%');

                if (timer <= 0) clearInterval(countdownInterval);
                else timer--;
            }

            updateTimer();
            countdownInterval = setInterval(updateTimer, 1000);
        }

        function toggleTicketType() {
            isInterstateState = !isInterstateState;

            document.querySelectorAll('.interstate').forEach(el => {
                el.textContent = isInterstateState ? 'INTERSTATE' : 'INTRASTATE';
                el.style.color = isInterstateState ? '#FF3237' : '#000000';
            });

            document.querySelectorAll('.header h2').forEach(title => {
                title.textContent = isInterstateState ? 'Monthly Pass' : 'One Way Ticket';
            });

            document.querySelectorAll('.modal-header-text').forEach(title => {
                title.textContent = isInterstateState ? 'Monthly Pass' : 'One Way Ticket';
            });

            document.querySelectorAll('.date-box').forEach(box => {
                box.style.display = isInterstateState ? 'block' : 'none';
            });

            if (!isInterstateState) startCountdown(30);
            else {
                clearInterval(countdownInterval);
                updateDynamicExpiry();
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            updateDynamicExpiry();
            setInterval(() => { if (isInterstateState) updateDynamicExpiry(); }, 60 * 1000);
        });
    </script>

    <script>
        const colors = [ '#c488c4', '#44A25A', '#F2CED5', '#F5DF25', '#fe6366', '#0C84E9', '#8F8F8F' ];
        let index = 0;

        function changeColor() {
            index = (index + 1) % colors.length;
            document.documentElement.style.setProperty('--first', colors[ index ]);
        }

        function increaseZone() {
            document.querySelectorAll('.big').forEach(el => {
                let val = parseInt(el.textContent, 10);
                if (val < 9) el.textContent = val + 1;
            });
        }

        function decreaseZone() {
            document.querySelectorAll('.big').forEach(el => {
                let val = parseInt(el.textContent, 10);
                if (val > 1) el.textContent = val - 1;
            });
        }
    </script>

    <div class="safe-area">
        <div class="content">
            <div class="container-new">
                <div class="subContainer">
                    <div class="header">
                        <svg xmlns="http://www.w3.org/2000/svg" width="35" height="35" viewBox="0 0 24 24">
                            <path fill="#ffffff" d="M14.41 18.16L8.75 12.5l5.66-5.66l.7.71l-4.95 4.95l4.95 4.95z" />
                        </svg>
                        <h2>Monthly Pass</h2>
                        <div class="right-empty"></div>
                    </div>
                </div>

                <div class="card">
                    <div class="top-section">
                        <div class="qr-box">
                            <div class="qr-inner">
                                <a href="#" onclick="openPopup(); return false;">
                                    <img class="qr-code" src="qr.png" alt="QR Code">
                                </a>
                            </div>
                        </div>

                        <div class="tap-to-enlarge-new">Tap to enlarge</div>
                        <div class="divider"></div>

                        <div class="interstate" onclick="toggleTicketType()">INTERSTATE</div>

                        <div class="date-zone">
                            <div class="date-box" onclick="changeColor()"></div>
                            <div>
                                <div class="overlay-new">
                                    <div class="top-zone" onclick="decreaseZone()"></div>
                                    <div class="bottom-zone" onclick="increaseZone()"></div>
                                </div>
                                <div class="zone-info">
                                    <p class="big">2</p>
                                    <p class="small">ZONE RIDE</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div>
                        <div class="color-strip">
                            <div class="color-block-new red"></div>
                            <div class="color-block-new green"></div>
                            <div class="color-block-new blue"></div>
                        </div>

                        <div class="bottom-section">
                            <div class="progress-bar">
                                <div class="progress-fill"></div>
                            </div>
                        </div>

                        <div class="exp"></div>
                        <div class="link">View Onboard Validator Instructions</div>
                    </div>
                </div>
            </div>

            <div class="popupModal" id="popupModal">
                <div class="modal-top-section">
                    <div class="modal-header">
                        <p class="modal-header-text">Monthly Pass</p>
                    </div>

                    <div class="modal-qr-box">
                        <div class="modal-qr-inner">
                            <img class="modal-qr-code" src="inner-qr.png" alt="QR Code">
                        </div>
                    </div>

                    <div class="modal-divider"></div>

                    <div class="interstate">INTERSTATE</div>

                    <div class="date-zone">
                        <div class="date-box"></div>
                        <div>
                            <div class="zone-info">
                                <p class="big">2</p>
                                <p class="small">ZONE RIDE</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="modal-bottom-section">
                    <div class="modal-color-strip">
                        <div class="color-block-new red"></div>
                        <div class="color-block-new green"></div>
                        <div class="color-block-new blue"></div>
                    </div>

                    <div class="modal-progress-section">
                        <div class="progress-bar">
                            <div class="progress-fill"></div>
                        </div>
                    </div>

                    <div class="exp"></div>

                    <div class="btn-view">
                        <div class="back-btn" onclick="closePopup()">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                                <path fill="#ffffff" d="M14.41 18.16L8.75 12.5l5.66-5.66l.7.71l-4.95 4.95l4.95 4.95z" />
                            </svg>
                            Back to ticket
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</body>

</html>